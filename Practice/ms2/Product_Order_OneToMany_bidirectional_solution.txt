Product.java


package com.examly.springapp.model;

import java.util.ArrayList;
import java.util.List;

import com.fasterxml.jackson.annotation.JsonManagedReference;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.OneToMany;
import jakarta.persistence.Table;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

@Entity
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Table(name="product")
public class Product {

    @Id
    @GeneratedValue(strategy=GenerationType.IDENTITY)
    private int productId;
    private String productName;
    private double price;
    @OneToMany(mappedBy="product")
    @JsonManagedReference
    private List<Order> orders=new ArrayList<>();
}

=====================================================================
Order.java

package com.examly.springapp.model;

import java.time.LocalDate;

import com.fasterxml.jackson.annotation.JsonBackReference;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.ManyToOne;
import jakarta.persistence.Table;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

@Entity
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Table(name="orders")
public class Order {

    @Id
    @GeneratedValue(strategy=GenerationType.IDENTITY)
    private int orderId;
    private int quantity;
    private LocalDate orderDate;
    @ManyToOne
    @JsonBackReference
    private Product product;
}

================================================================
DuplicateProductException.java

package com.examly.springapp.exception;

public class DuplicateProductException extends RuntimeException{

    public DuplicateProductException(String message){
        super(message);
    }
}

==================================================================
ProductRepo.java

package com.examly.springapp.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import com.examly.springapp.model.Product;

@Repository
public interface ProductRepo extends JpaRepository<Product,Integer>{
    Product findByProductName(String productName);
}

===================================================================
OrderRepo.java

package com.examly.springapp.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import com.examly.springapp.model.Order;

@Repository
public interface OrderRepo extends JpaRepository<Order,Integer>{
    @Query("select count(o) from Order o where o.product.productId= :productId")
    long giveCountOrdersByProductId( int productId);

    
}

====================================================================
ProductService.java

package com.examly.springapp.service;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.examly.springapp.exception.DuplicateProductException;
import com.examly.springapp.model.Product;
import com.examly.springapp.repository.ProductRepo;


@Service
public class ProductService {

    @Autowired
    ProductRepo pr;

    public Product createProduct(Product product){
        Product p=pr.findByProductName(product.getProductName());
        if(p!=null){
            throw new DuplicateProductException("Product with name "+product.getProductName()+" already exists");
        }
        return pr.save(product);
    }

    public Product getProductById(int productId){
        return pr.findById(productId).orElse(null);
    }

    public List<Product> getAllProduct(){
        return pr.findAll();
    }
}

==================================================================
OrderService.java

package com.examly.springapp.service;

import java.util.*;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.examly.springapp.model.Order;
import com.examly.springapp.model.Product;
import com.examly.springapp.repository.OrderRepo;
import com.examly.springapp.repository.ProductRepo;


@Service
public class OrderService {

    @Autowired
    ProductRepo pr;

    @Autowired
    OrderRepo or;

    public Order createAndMapOrderToProduct(int productId,Order order){
        Optional<Product> opp=pr.findById(productId);
        if(opp.isPresent()){
            Product p=opp.get();
            order.setProduct(p);
            return or.save(order);
        }
        return null;
    }

    public List<Order> getAllOrders(){
        return or.findAll();
    }

    public Order updateOrder(int orderId,Order order){
        Optional<Order> opo=or.findById(orderId);
        if(opo.isPresent()){
            Order o=opo.get();
            o.setQuantity(order.getQuantity());
            // order.setOrderId(o.getOrderId());
            return or.save(o);
        }
        return null;
    }

    public boolean deleteOrder(int orderId){
        if(or.existsById(orderId)){
            or.deleteById(orderId);
            return true;
        }
        return false;
    }

    public List<Order> getOrderByProduct(int productId){
        Product p=pr.findById(productId).orElse(null);
        if(p!=null){
            return p.getOrders();
        }
        return null;
    }

    public long getCountOfOrders(int productId){
        // List<Order> l=or.findAll();
        // return (long)(l.size());
        return or.giveCountOrdersByProductId(productId);
    }
}

=====================================================================
ProductController.java


package com.examly.springapp.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import com.examly.springapp.exception.DuplicateProductException;
import com.examly.springapp.model.Product;
import com.examly.springapp.service.ProductService;


@RestController
public class ProductController {

    @Autowired
    ProductService serv;

    @PostMapping("/product")
    public ResponseEntity<?> createProduct(@RequestBody Product product){
        try{
            Product p=serv.createProduct(product);
            if(p==null){
                return ResponseEntity.status(500).build();
            }
            return ResponseEntity.status(201).body(p);
        }catch(DuplicateProductException e){
            return ResponseEntity.status(500).body(e.getMessage());
        }
    }

    @GetMapping("/product/{productId}")
    public ResponseEntity<Product> getProductById(@PathVariable int productId){
        Product p=serv.getProductById(productId);
        if(p==null){
            return ResponseEntity.status(404).build();
        }
        return ResponseEntity.status(200).body(p);
    }

    @GetMapping("/product")
    public ResponseEntity<List<Product>> getAllProduct(){
        List<Product> p=serv.getAllProduct();
        if(p.isEmpty()){
            return ResponseEntity.status(404).build();
        }
        return ResponseEntity.status(200).body(p);
    }
}


=====================================================================
OrderController.java


package com.examly.springapp.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import com.examly.springapp.model.Order;
import com.examly.springapp.service.OrderService;

@RestController
public class OrderController {

    @Autowired
    OrderService serv;

    @PostMapping("/order/product/{productId}")
    public ResponseEntity<Order> createAndMapOrderToProduct(@PathVariable int productId,@RequestBody Order order){
        Order o=serv.createAndMapOrderToProduct(productId,order);
        if(o==null){
            return ResponseEntity.status(500).build();
        }
        return ResponseEntity.status(201).body(o);
    }

    @GetMapping("/order")
    public ResponseEntity<List<Order>> getAllOrders(){
        List<Order> o=serv.getAllOrders();
        if(o.isEmpty()){
            return ResponseEntity.status(404).build();
        }
        return ResponseEntity.status(200).body(o);
    }

    @PutMapping("/order/{orderId}")
    public ResponseEntity<Order> updateOrder(@PathVariable int orderId,@RequestBody Order order){
        Order o=serv.updateOrder(orderId,order);
        if(o==null){
            return ResponseEntity.status(404).build();
        }
        return ResponseEntity.status(200).body(o);
    }

    @DeleteMapping("/order/{orderId}")
    public ResponseEntity<String> deleteOrder(@PathVariable int orderId){
        if(serv.deleteOrder(orderId)){
            return ResponseEntity.status(200).body("Order deleted successfully");
        }
        return ResponseEntity.status(200).body("Order not found with ID: "+orderId);
    }

    @GetMapping("/order/product/{productId}")
    public ResponseEntity<List<Order>> getOrderByProduct(@PathVariable int productId){
        List<Order> o=serv.getOrderByProduct(productId);
        if(o.isEmpty()){
            return ResponseEntity.status(404).build();
        }
        return ResponseEntity.status(200).body(o);
    }

    @GetMapping("/order/count/{productId}")
    public ResponseEntity<Long> getCountOfOrders(@PathVariable int productId){
        long o=serv.getCountOfOrders(productId);
        if(o!=0){
            return ResponseEntity.status(200).body(o);
        }
        return ResponseEntity.status(404).build();
    }
}
